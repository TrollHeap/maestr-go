{{define "exercise-detail"}}
<div id="exercise-detail" class="exercise-detail">
    <div class="exercise-detail__header">
        <h2 class="exercise-detail__title">{{.Exercise.Title}}</h2>
    </div>
    <p class="exercise-detail__description">{{.Exercise.Description}}</p>
    <div class="exercise-detail__badges">
        <span class="badge badge--domain-{{.Exercise.Domain | lower}} badge--md">
            {{.Exercise.Domain}}
        </span>
        <span class="badge badge--difficulty-{{.Exercise.Difficulty}} badge--md">
            D{{.Exercise.Difficulty}}
        </span>
        <span class="badge badge--progress badge--md">
            {{len .Exercise.CompletedSteps}}/{{len .Exercise.Steps}} √©tapes
        </span>
    </div>
    <hr class="exercise-detail__divider">
    <!-- Visuels -->
    {{if .Exercise.ConceptualVisuals}}
    <div class="conceptual-visuals">
        <h3 class="exercise-detail__section-title">VISUALISATION</h3>
        {{range $index, $visual := .Exercise.ConceptualVisuals}}
        <div class="visual-aid">
            {{if eq $visual.Type "ascii"}}
            <pre class="ascii-diagram">{{$visual.Content}}</pre>
            {{end}}
            {{if $visual.Caption}}
            <div class="visual-caption">üí° {{$visual.Caption}}</div>
            {{end}}
        </div>
        {{end}}
        {{if .Exercise.Mnemonic}}
        <div class="mnemonic-box">
            üß† <strong>Mn√©motechnique :</strong> {{.Exercise.Mnemonic}}
        </div>
        {{end}}
    </div>
    <hr class="exercise-detail__divider">
    {{end}}
    {{template "steps-exo" .Exercise}}
    <hr class="exercise-detail__divider">
    <div>
        <h3 class="exercise-detail__section-title">CONTENU</h3>
        <div class="exercise-detail__content">{{.Exercise.Content | noescape}}</div>
    </div>
    <hr class="exercise-detail__divider">
    <div class="exercise-detail__badges">
        <button 
            class="status-indicator status-indicator--{{if .Exercise.Done}}done{{else if gt (len .Exercise.CompletedSteps) 0}}wip{{else}}todo{{end}}"
            hx-post="/toggle-status?id={{.Exercise.ID}}"
            hx-target="#exercise-detail"
            hx-swap="outerHTML">
            <span class="status-indicator__icon">{{if .Exercise.Done}}‚úì{{else if gt (len .Exercise.CompletedSteps) 0}}‚óê{{else}}‚óã{{end}}</span>
            <span>{{if .Exercise.Done}}DONE{{else if gt (len .Exercise.CompletedSteps) 0}}EN COURS{{else}}√Ä FAIRE{{end}}</span>
        </button>
    </div>
    {{if .Exercise.Done}}
    {{template "review-panel" .Exercise}}
    {{end}}
</div>
{{end}}
