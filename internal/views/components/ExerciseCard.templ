// internal/views/components/ExerciseCard.templ
package components

import (
	"fmt"
	"strconv"

	"maestro/internal/models"
	"maestro/internal/views/ui"
)

templ ExerciseCard(ex models.Exercise) {
	<div class="group relative flex flex-col rounded-2xl border border-slate-800 bg-slate-950/80 p-4 shadow-sm shadow-slate-950/40 transition-all hover:border-sky-500/60 hover:shadow-lg hover:shadow-sky-900/40">
		<!-- Titre + statut -->
		<div class="flex items-start justify-between gap-3 mb-3">
			<div class="space-y-1">
				<h3 class="text-sm font-semibold text-slate-50 line-clamp-2">
					{ ex.Title }
				</h3>
				if ex.Description != "" {
					<p class="text-xs text-slate-400 line-clamp-2">
						{ ex.Description }
					</p>
				}
			</div>
			<!-- âœ… BADGE STATUS REFACTORÃ‰ -->
			if ex.Done {
				@ui.BadgeWithIcon("MaÃ®trisÃ©", "âœ“", ui.BadgeStatus, ui.BadgeSM)
			} else {
				@ui.BadgeWithIcon("En cours", "âŠ™", ui.BadgeStatus, ui.BadgeSM)
			}
		</div>
		<!-- Badges / meta -->
		<div class="flex items-center justify-between gap-2 mb-3">
			<div class="flex items-center gap-1.5">
				<!-- âœ… BADGE DOMAIN REFACTORÃ‰ -->
				@ui.Badge(ex.Domain, ui.BadgeDomain, ui.BadgeSM)
				<!-- âœ… BADGE DIFFICULTY REFACTORÃ‰ -->
				@ui.Badge(fmt.Sprintf("D%d", ex.Difficulty), ui.BadgeDifficulty, ui.BadgeSM)
			</div>
			<div class="text-[0.6rem] text-slate-400 text-right">
				if !ex.NextReviewAt.IsZero() {
					<span>ğŸ“† { ex.NextReviewAt.Format("02/01/2006") }</span>
				} else {
					<span class="italic text-slate-500">Jamais rÃ©visÃ©</span>
				}
			</div>
		</div>
		<!-- Progress -->
		<div class="mb-3">
			@ui.ProgressBar(len(ex.CompletedSteps), len(ex.Steps))
		</div>
		<!-- Footer actions -->
		<div class="mt-auto flex items-center justify-between gap-2 pt-2 border-t border-slate-800">
			<a
				href={ templ.URL("/exercise/" + strconv.Itoa(ex.ID)) }
				hx-boost="true"
				class="inline-flex items-center gap-1.5 text-[0.7rem] text-sky-300 hover:text-sky-200"
			>
				<span>ğŸ”</span>
				<span>Ouvrir</span>
			</a>
			<div class="inline-flex items-center gap-1.5 rounded-full border border-slate-700 bg-slate-900/80 px-1.5 py-1">
				<a
					href={ templ.URL("/exercise/" + strconv.Itoa(ex.ID) + "/edit") }
					hx-boost="true"
					class="inline-flex items-center gap-1.5 rounded-full bg-emerald-900/50 px-2.5 py-1 text-[0.6rem] font-mono tracking-widest uppercase text-emerald-200 hover:bg-emerald-800/70 hover:border-emerald-400 border border-emerald-500/60 transition-colors"
				>
					<span>âœï¸</span>
					<span>Ã‰diter</span>
				</a>
				<button
					type="button"
					hx-post={ templ.URL("/exercise/" + strconv.Itoa(ex.ID) + "/delete") }
					hx-confirm="Supprimer cet exercice ? Cette action est irrÃ©versible."
					hx-target="#exercise-list"
					hx-swap="innerHTML"
					class="inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-[0.6rem] font-mono tracking-widest uppercase text-rose-200 hover:bg-rose-900/60 hover:border-rose-400 border border-transparent transition-colors"
				>
					<span>ğŸ—‘ï¸</span>
					<span>Suppr.</span>
				</button>
			</div>
		</div>
	</div>
}
