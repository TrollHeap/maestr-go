// internal/views/pages/Dashboard.templ
package pages

import (
	"fmt"
	"maestro/internal/models"
	"maestro/internal/views/components"
	"maestro/internal/views/layouts"
	"maestro/internal/views/ui"
	"time"
)

templ Dashboard(
	stats models.DashboardStats,
	todayCount int,
	overdueCount int,
	upcomingCount int,
	overdue []models.Exercise,
	upcoming []models.Exercise,
) {
	@layouts.Base("Analytics Dashboard - Maestro") {
		<div class="relative min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950">
			<!-- Ambient Effects -->
			<div class="pointer-events-none absolute inset-0 overflow-hidden opacity-40">
				<div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,_rgba(56,189,248,0.1),_transparent_50%)]"></div>
				<div class="absolute inset-0 bg-[radial-gradient(circle_at_70%_80%,_rgba(168,85,247,0.1),_transparent_50%)]"></div>
			</div>
			<div class="relative z-10 max-w-[1920px] mx-auto px-6 py-8 space-y-6">
				<!-- ============================================ -->
				<!-- HERO SECTION: Status + Actions Rapides -->
				<!-- ============================================ -->
				<div class="flex items-center justify-between mb-8">
					@ui.TerminalHeaderWithDate("MISSION_CONTROL.ANALYTICS", time.Now(), ui.HeaderSky)
					<!-- Quick Actions -->
					<div class="flex items-center gap-3">
						<a
							href="/session/builder"
							class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-purple-500/60 bg-purple-900/40 text-purple-200 
                                font-mono text-xs tracking-wider uppercase hover:bg-purple-800/60 hover:border-purple-400 transition-all hover:shadow-[0_0_20px_rgba(168,85,247,0.4)]"
							hx-boost="true"
						>
							<span class="text-xl animate-pulse">âš¡</span>
							<span>START SESSION</span>
							<span class="text-xs opacity-60">â†’</span>
						</a>
						<a
							href="/exercises/new"
							class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-slate-700 bg-slate-900/80 text-slate-300 
                            font-mono text-xs uppercase tracking-wider hover:border-sky-500/60 hover:bg-slate-800 transition-all"
							hx-boost="true"
						>
							<span>+</span>
							<span>NEW EXERCISE</span>
						</a>
					</div>
				</div>
				<!-- ============================================ -->
				<!-- KPI GRID: 4 cartes principales -->
				<!-- ============================================ -->
				<div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
					@components.KPICard("TODAY", todayCount, "reviews", "â°", todayCount > 5, "/session/builder", stats.CompletionRate)
					@components.KPICard("OVERDUE", overdueCount, "critical", "âš ", overdueCount > 0, "/planner?view=urgent", 0)
					@components.KPICard("STREAK", stats.StreakDays, "days", "ðŸ”¥", stats.StreakDays >= 7, "/planner", 0)
					@components.KPICard("MASTERED", stats.TotalMastered, fmt.Sprintf("/%d", stats.TotalExercises), "âœ“", false, "/exercises?status=mastered", stats.CompletionRate)
				</div>
				<!-- ============================================ -->
				<!-- MAIN GRID: 3 colonnes responsives -->
				<!-- ============================================ -->
				<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
					<!-- ===== COLONNE 1: Performance + SRS ===== -->
					<div class="space-y-6">
						<!-- Performance Overview -->
						@components.PerformanceCard(stats)
						<!-- SRS Health -->
						@components.SRSHealthCard(stats)
					</div>
					<!-- ===== COLONNE 2: Activity + Priority ===== -->
					<div class="space-y-6">
						<!-- Activity Heatmap -->
						@components.ActivityHeatmapV2(stats)
						<!-- Priority Queue -->
						@components.PriorityQueueCard(overdue, upcoming)
					</div>
					<!-- ===== COLONNE 3: Insights + Weaknesses ===== -->
					<div class="space-y-6">
						<!-- AI Insights -->
						@components.InsightsCard(stats, todayCount, overdueCount)
						<!-- Weak Exercises -->
						@components.WeaknessCard(stats)
						<!-- Domain Strength -->
						@components.DomainStrengthCard(stats)
					</div>
				</div>
				<!-- ============================================ -->
				<!-- BOTTOM SECTION: Advanced Analytics -->
				<!-- ============================================ -->
				<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
					<!-- Review Distribution -->
					@components.ReviewDistribCard(stats)
					<!-- Time Investment -->
					@components.TimeInvestCard(stats)
				</div>
			</div>
		</div>
	}
}
