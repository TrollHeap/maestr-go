// internal/views/pages/exercises.templ
package pages

import (
	"fmt"
	"maestro/internal/models"
	"maestro/internal/views/components"
	"maestro/internal/views/layouts"
)

// ExerciseListPage - Page complÃ¨te liste exercices
templ ExerciseListPage(
	exercises []models.Exercise,
	urgentCount, todayCount, upcomingCount, activeCount, newCount int,
) {
	@layouts.Base("Exercices - Maestro Terminal") {
		<div class="relative min-h-[calc(100vh-4rem)] bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-slate-50">
			<!-- Scan / overlay -->
			<div class="pointer-events-none absolute inset-0 overflow-hidden">
				<div class="absolute inset-x-0 h-px bg-gradient-to-r from-transparent via-sky-400/40 to-transparent top-20 animate-[pulse_2s_ease-in-out_infinite]"></div>
				<div class="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(56,189,248,0.12),_transparent_55%)]"></div>
			</div>
			<div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
				<!-- Header -->
				<header class="mb-8">
					<div class="mb-4 inline-flex items-center gap-3 px-4 py-2 rounded-full bg-sky-500/10 border border-sky-400/40 text-xs font-mono text-sky-300 tracking-widest">
						<span class="inline-block h-2 w-2 rounded-full bg-sky-400 animate-pulse"></span>
						<span>&gt; EXERCICES DATABASE</span>
						<span class="opacity-60">|</span>
						<span>STATUS: <span class="animate-pulse">ONLINE</span></span>
					</div>
					<h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight text-slate-50 mb-6">
						ğŸ“š BibliothÃ¨que d'exercices
					</h1>
					<!-- Stats Cards -->
					<div class="grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-5 mb-6">
						@StatCard("ğŸ”¥ En retard", urgentCount, "urgent")
						@StatCard("ğŸ“… Aujourd'hui", todayCount, "today")
						@StatCard("â° Ã€ venir", upcomingCount, "upcoming")
						@StatCard("âš¡ Actifs", activeCount, "active")
						@StatCard("ğŸ†• Nouveaux", newCount, "new")
					</div>
					<!-- Filtres -->
					<div class="inline-flex items-center gap-2 rounded-full border border-slate-700 bg-slate-900/80 p-1 flex-wrap">
						<button
							class="filter-btn inline-flex items-center gap-2 rounded-full bg-slate-800 px-4 py-1.5 text-xs font-mono text-sky-300 tracking-widest uppercase transition-colors"
							hx-get="/exercises/list?view=all"
							hx-target="#exercise-list"
							hx-swap="innerHTML"
						>
							Tous
						</button>
						<button
							class="filter-btn inline-flex items-center gap-2 rounded-full px-4 py-1.5 text-xs font-mono text-slate-300 hover:bg-slate-800 transition-colors"
							hx-get="/exercises/list?view=urgent"
							hx-target="#exercise-list"
							hx-swap="innerHTML"
						>
							En retards
						</button>
						<button
							class="filter-btn inline-flex items-center gap-2 rounded-full px-4 py-1.5 text-xs font-mono text-slate-300 hover:bg-slate-800 transition-colors"
							hx-get="/exercises/list?view=today"
							hx-target="#exercise-list"
							hx-swap="innerHTML"
						>
							Aujourd'hui
						</button>
						<button
							class="filter-btn inline-flex items-center gap-2 rounded-full px-4 py-1.5 text-xs font-mono text-slate-300 hover:bg-slate-800 transition-colors"
							hx-get="/exercises/list?view=upcoming"
							hx-target="#exercise-list"
							hx-swap="innerHTML"
						>
							Ã€ venir
						</button>
						<button
							class="filter-btn inline-flex items-center gap-2 rounded-full px-4 py-1.5 text-xs font-mono text-slate-300 hover:bg-slate-800 transition-colors"
							hx-get="/exercises/list?view=new"
							hx-target="#exercise-list"
							hx-swap="innerHTML"
						>
							Nouveaux
						</button>
					</div>
				</header>
				<!-- Liste exercices (HTMX target) -->
				<section id="exercise-list">
					@components.ExerciseListFragment(exercises)
				</section>
			</div>
		</div>
	}
}

// StatCard - Card statistique
templ StatCard(label string, count int, cssClass string) {
	<div
		class={
			"stat-card rounded-xl border bg-slate-900/60 backdrop-blur-sm px-4 py-3 text-center transition-all hover:border-sky-500/60 hover:bg-slate-900",
			getStatCardBorderClass(cssClass),
		}
	>
		<div class="stat-label text-[0.65rem] font-medium uppercase tracking-widest text-slate-400 mb-1">
			{ label }
		</div>
		<div
			class={
				"stat-value text-xl font-bold",
				getStatCardTextClass(cssClass),
			}
		>
			{ fmt.Sprintf("%d", count) }
		</div>
	</div>
}

func getStatCardBorderClass(cssClass string) string {
	switch cssClass {
	case "urgent":
		return "border-rose-500/40"
	case "today":
		return "border-sky-500/40"
	case "upcoming":
		return "border-amber-500/40"
	case "active":
		return "border-emerald-500/40"
	case "new":
		return "border-purple-500/40"
	default:
		return "border-slate-700"
	}
}

func getStatCardTextClass(cssClass string) string {
	switch cssClass {
	case "urgent":
		return "text-rose-400"
	case "today":
		return "text-sky-400"
	case "upcoming":
		return "text-amber-400"
	case "active":
		return "text-emerald-400"
	case "new":
		return "text-purple-400"
	default:
		return "text-slate-300"
	}
}
